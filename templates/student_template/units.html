{% extends "student_template/base_template.html" %}
{% block custom_css %}
<style>
.col-lg-4.attendance_div_green {
    padding: 10px;
    padding-top: 5px;
    padding-bottom: 5px;
    background: #388e3c;
    border: 10px solid white;
    text-align: left;
    color: #fff;
    border-radius: 30px;
    box-shadow: 1px 1px 1px grey;
    margin-top: 10px;
    margin-bottom: 10px;
}
.col-lg-3.attendance_div_red {
    padding: 10px;
    padding-top: 20px;
    padding-bottom: 20px;
    background: #f44336;
    border: 10px solid white;
    text-align: center;
    color: #fff;
    border-radius: 30px;
    box-shadow: 1px 1px 1px grey;
    margin-top: 10px;
    margin-bottom: 10px;
}
</style>
{% endblock custom_css %}
{% block page_title %} Exam Card {% endblock page_title %}
{% load static %}
{% block main_content %}
<section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6">
            <!-- general form elements -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Units</h3>
              </div>
              <div class="card-body">
                <div class="form-group">
                    <select class="form-control"  name="stage" id="stage">
                        {% for Stage in Stage %}
                          <option value="{{ Stage.id }}">{{ Stage.stage }}</option>
                        {% endfor %}
                    </select>
                    {% for Stage in Stage %}
                        <input type="hidden" name="Students" id="Students" value="{{ student_obj.admin.id }}">
                    {% endfor %}
                </div>
                <button type="button" class="btn btn-primary btn-sm " id="fetch_units">Fetch Units</button>
                <div class="form-group">
                    {% if messages %}
                      {% for message in messages %}
                      {% if message.tags == 'error' %}
                     <div class="alert alert-danger" style="margin-top:10px" >{{ message }}</div>
                     {% endif %}
                     {% if message.tags == 'success' %}
                     <div class="alert alert-success" style="margin-top:10px" >{{ message }}</div>
                     {% endif %}
                     {% endfor %}
                   {% endif %}
                </div>
              </div>
                <!-- /.card-body -->
              <div class="card-footer">
              </div>
              <div id="student_data" class="card-footer" ></div>
            </div>
          </div>
        </div>
            <!-- /.card -->
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
{% endblock main_content %}
{% block custom_js %}
<script>
  $(document).ready(function(){
    $("#fetch_units").click(function(){
      var stage=$("#stage").val();


      $.ajax({
        url:'{% url 'units' %}',
        type:'POST',
        data:{stage:stage},
      })
      .done(function(response){
        var json_data=JSON.parse(response);
        console.log(json_data)
        var div_data="<div class='row'><div class='col-md-5'></div><div class='col-md-5'><img src='{{ student_obj.profile_pic }}' style='width:70px; opacity: .8;' class='brand-image img-circle elevation-3' /></div></div><div class='row'><div class='col-md-3'></div><div class='col-md-8'><h4 class='text-bold'>EXAMINATION CARD</h4></div></div><div class='row'><table class='table text-bold'><tr><td width='100px'>Stud. No</td><td>{{ student_obj.admin.username }}</td></tr><tr><td width='100px'>Name</td><td>{{ student_obj.admin.first_name }}&nbsp;&nbsp;{{ student_obj.admin.last_name }}</td></tr><tr><td width='100px'>Prog</td><td>{{ student_obj.course_id.course_name }}</td></tr><tr></table></div><div class='row'><table class='table' border='1' name='student_data[]'><tr><th>Course Code</th><th>Description</th><th>Signature</th></tr>";
        for(key in json_data){
            div_data+="<tr value='"+json_data[key]['id']+"'><td>"+json_data[key]['code']+"</td><td>"+json_data[key]['name']+"</td><td></td></tr>";
        }
        div_data+="</table></div>";
        div_data+="<div class='form-group'>";
        div_data+="<button id='exam_card' class='btn btn-success btn-sm' type='button'>Open</button>";
        div_data+="</div>";
        $("#student_data").html(div_data);
      })
      .fail(function(){
        alert("error in fetching Units")
      })
    })
  })

</script>
{% endblock custom_js %}