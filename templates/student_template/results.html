{% extends 'student_template/base_template.html' %}
{% block page_title %} Transcript {% endblock page_title %}
{% load static %}
{% block main_content %}
<section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6">
            <!-- general form elements -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Transcript</h3>
              </div>
              <div class="card-body">
                  <form role="form" action="/render_pdf_view/{{ student.id }}/" method="POST">
                    {% csrf_token %}
                    <select class="form-control"  name="stage">
                        {% for Stage in Stage %}
                            <option value="{{ Stage.semester_id.id }}">{{ Stage.semester_id.stage }}</option>
                        {% endfor %}
                    </select><br/>
                     <button class="btn btn-primary btn-sm" type="submit">Open</button>
                  </form>
                <div id="student_data" class="card-footer" ></div>
            </div>
          </div>
        </div>
      </div><!-- /.container-fluid -->
</section>
    <!-- /.content -->
{% endblock main_content %}
{% block custom_js %}
<script>
$(document).ready(function(){
    $("#fetch_results").click(function(){
        var stage = $("#stage").val();
        $.ajax({
            url:'{% url 'get_results' %}',
            type:'POST',
            data:{stage:stage},
        })
        .done(function(response){
            var json_data = JSON.parse(response);
            console.log(json_data);
            if (json_data==""){
                alert("Results Not Posted")
            }
            else{
                var div_data="<div class='form-group'><div class='row'>";
                div_data="<label>{{ student.username }}</label>";
                div_data+="<table border='1'><tr>";
                for(key in json_data){
                    div_data+="<td name='student_data[]'></td>";
                }
                div_data+="</tr></table>";
                div_data+="<a href='/render_pdf_view/{{ student.id }}/{{ Stage.semester_id.id }}'><button class='btn btn-primary'>Open</button></a>";
                div_data+="</div></div>";
                $("#student_data").html(div_data);
            }
        })
        .fail(function(){
            alert("Failed")
        })
    })
})
</script>
{% endblock custom_js %}